# æœåŠ¡å™¨éƒ¨ç½²æ–°æ‰‹æŒ‡å—ï¼ˆé›¶åŸºç¡€ï¼‰

æœ¬æŒ‡å—ä¸“ä¸º**æ²¡ç”¨è¿‡ Docker** çš„ç”¨æˆ·å‡†å¤‡ï¼ŒåŒ…å«æ¯ä¸€ä¸ªè¯¦ç»†æ­¥éª¤ã€‚

---

## ğŸ“‹ å‡†å¤‡å·¥ä½œ

### ä½ éœ€è¦ä»€ä¹ˆï¼Ÿ

1. âœ… ä¸€å°æœåŠ¡å™¨ï¼ˆUbuntu 20.04 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰
2. âœ… æœåŠ¡å™¨çš„ IP åœ°å€
3. âœ… æœåŠ¡å™¨çš„ SSH ç™»å½•è´¦å·å’Œå¯†ç 
4. âœ… æœ¬åœ°ç”µè„‘èƒ½è¿æ¥åˆ°æœåŠ¡å™¨

---

## ç¬¬ä¸€æ­¥ï¼šè¿æ¥åˆ°æœåŠ¡å™¨

### Windows ç”¨æˆ·

**æ–¹æ³•1ï¼šä½¿ç”¨ PowerShellï¼ˆæ¨èï¼‰**
```powershell
# æ‰“å¼€ PowerShellï¼Œè¾“å…¥ï¼š
ssh ç”¨æˆ·å@æœåŠ¡å™¨IP

# ä¾‹å¦‚ï¼š
ssh root@192.168.1.100
```

**æ–¹æ³•2ï¼šä½¿ç”¨ Xshell æˆ– PuTTY**
- ä¸‹è½½å®‰è£… [Xshell](https://www.xshell.com/) æˆ– [PuTTY](https://www.putty.org/)
- è¾“å…¥æœåŠ¡å™¨ IP
- è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
- è¿æ¥

### Mac/Linux ç”¨æˆ·

```bash
# æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ï¼š
ssh ç”¨æˆ·å@æœåŠ¡å™¨IP
```

**æç¤ºï¼š** ç¬¬ä¸€æ¬¡è¿æ¥ä¼šé—®ä½  `Are you sure you want to continue connecting?`ï¼Œè¾“å…¥ `yes` å›è½¦å³å¯ã€‚

---

## ç¬¬äºŒæ­¥ï¼šå®‰è£… Dockerï¼ˆä¸€æ¬¡æ€§æ“ä½œï¼‰

è¿æ¥åˆ°æœåŠ¡å™¨åï¼Œ**å¤åˆ¶ä¸‹é¢çš„å‘½ä»¤ï¼Œä¸€è¡Œä¸€è¡Œæ‰§è¡Œ**ï¼š

### 1. æ›´æ–°ç³»ç»Ÿ

```bash
sudo apt-get update
sudo apt-get upgrade -y
```

ğŸ’¡ **è¯´æ˜**ï¼šæ›´æ–°æœåŠ¡å™¨çš„è½¯ä»¶åŒ…åˆ—è¡¨ï¼Œéœ€è¦ç­‰å¾…1-3åˆ†é’Ÿã€‚

### 2. å®‰è£… Docker

```bash
# å®‰è£…ä¾èµ–
sudo apt-get install -y apt-transport-https ca-certificates curl software-properties-common

# æ·»åŠ  Docker å®˜æ–¹å¯†é’¥
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -

# æ·»åŠ  Docker ä»“åº“
sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"

# å®‰è£… Docker
sudo apt-get update
sudo apt-get install -y docker-ce docker-ce-cli containerd.io

# å¯åŠ¨ Docker
sudo systemctl start docker
sudo systemctl enable docker
```

ğŸ’¡ **è¯´æ˜**ï¼šå®‰è£… Dockerï¼Œéœ€è¦ç­‰å¾…3-5åˆ†é’Ÿã€‚

### 3. å®‰è£… Docker Compose

```bash
# ä¸‹è½½ Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose

# æ·»åŠ æ‰§è¡Œæƒé™
sudo chmod +x /usr/local/bin/docker-compose
```

### 4. éªŒè¯å®‰è£…

```bash
# æ£€æŸ¥ Docker ç‰ˆæœ¬
docker --version

# æ£€æŸ¥ Docker Compose ç‰ˆæœ¬
docker-compose --version
```

**çœ‹åˆ°ç‰ˆæœ¬å·å°±è¯´æ˜å®‰è£…æˆåŠŸäº†ï¼** âœ…

---

## ç¬¬ä¸‰æ­¥ï¼šä¸Šä¼ é¡¹ç›®åˆ°æœåŠ¡å™¨

### æ–¹æ³•1ï¼šä½¿ç”¨ Gitï¼ˆæ¨èï¼‰

å¦‚æœä½ çš„é¡¹ç›®åœ¨ GitHub ä¸Šï¼š

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/ä½ çš„ç”¨æˆ·å/caculate_net_value.git

# è¿›å…¥é¡¹ç›®ç›®å½•
cd caculate_net_value
```

### æ–¹æ³•2ï¼šä½¿ç”¨ SCP ä¸Šä¼ 

åœ¨**æœ¬åœ°ç”µè„‘**ä¸Šæ‰§è¡Œï¼š

```bash
# Windows PowerShell / Mac Terminal
scp -r D:\Desktop\caculate_net_value ç”¨æˆ·å@æœåŠ¡å™¨IP:/home/ç”¨æˆ·å/

# ä¾‹å¦‚ï¼š
scp -r D:\Desktop\caculate_net_value root@192.168.1.100:/root/
```

ç„¶ååœ¨æœåŠ¡å™¨ä¸Šï¼š

```bash
cd /root/caculate_net_value
# æˆ–
cd /home/ä½ çš„ç”¨æˆ·å/caculate_net_value
```

---

## ç¬¬å››æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡ï¼ˆé‡è¦ï¼ï¼‰

```bash
# 1. å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp docker/env.example .env

# 2. ç¼–è¾‘é…ç½®æ–‡ä»¶
nano .env
```

**æ‰“å¼€åä½ ä¼šçœ‹åˆ°è¿™æ ·çš„å†…å®¹ï¼š**

```bash
POSTGRES_DB=net_value_db
POSTGRES_USER=netvalue_user
POSTGRES_PASSWORD=your_secure_password_here  â† ä¿®æ”¹è¿™é‡Œï¼
POSTGRES_PORT=5432

WEB_PORT=5000
API_PORT=8080

FLASK_ENV=production
LOG_LEVEL=INFO
```

**æ“ä½œæ­¥éª¤ï¼š**

1. ç”¨æ–¹å‘é”®ç§»åŠ¨åˆ° `POSTGRES_PASSWORD=` è¿™ä¸€è¡Œ
2. åˆ é™¤ `your_secure_password_here`
3. è¾“å…¥ä¸€ä¸ªå¼ºå¯†ç ï¼ˆä¾‹å¦‚ï¼š`MyPassword123!@#`ï¼‰
4. æŒ‰ `Ctrl + O` ä¿å­˜ï¼ˆä¼šæç¤ºæ–‡ä»¶åï¼Œç›´æ¥å›è½¦ï¼‰
5. æŒ‰ `Ctrl + X` é€€å‡º

ğŸ’¡ **æç¤º**ï¼šå¯†ç è¦å¤æ‚ä¸€ç‚¹ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦ã€‚

---

## ç¬¬äº”æ­¥ï¼šå¯åŠ¨æœåŠ¡ï¼ˆæœ€å…³é”®ï¼ï¼‰

### æ–¹æ³•1ï¼šä½¿ç”¨ä¸€é”®è„šæœ¬ï¼ˆæœ€ç®€å•ï¼‰â­â­â­

```bash
# ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x docker-start.sh

# è¿è¡Œè„šæœ¬
./docker-start.sh
```

**ç­‰å¾… 2-5 åˆ†é’Ÿ**ï¼Œçœ‹åˆ°è¿™æ ·çš„æç¤ºå°±æˆåŠŸäº†ï¼š

```
================================
âœ… éƒ¨ç½²å®Œæˆï¼
================================

è®¿é—®åœ°å€ï¼š
  Web ç•Œé¢: http://localhost:5000
  API æ¥å£: http://localhost:8080
```

### æ–¹æ³•2ï¼šæ‰‹åŠ¨å¯åŠ¨ï¼ˆå¦‚æœè„šæœ¬å¤±è´¥ï¼‰

```bash
# è¿›å…¥ docker ç›®å½•
cd docker

# ç»™éƒ¨ç½²è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x deploy.sh

# è¿è¡Œéƒ¨ç½²è„šæœ¬
./deploy.sh
```

### æ–¹æ³•3ï¼šå®Œå…¨æ‰‹åŠ¨ï¼ˆæœ€åŸºç¡€ï¼‰

```bash
# è¿›å…¥ docker ç›®å½•
cd docker

# åœæ­¢æ—§å®¹å™¨ï¼ˆå¦‚æœæœ‰ï¼‰
docker-compose down

# æ„å»ºé•œåƒ
docker-compose build

# å¯åŠ¨æœåŠ¡
docker-compose up -d
```

**å‚æ•°è¯´æ˜ï¼š**
- `-d`ï¼šåå°è¿è¡Œï¼ˆä¸ä¼šå ç”¨ç»ˆç«¯ï¼‰

---

## ç¬¬å…­æ­¥ï¼šéªŒè¯æœåŠ¡æ˜¯å¦æˆåŠŸ

### 1. æŸ¥çœ‹å®¹å™¨çŠ¶æ€

```bash
cd docker
docker-compose ps
```

**æ­£å¸¸æƒ…å†µåº”è¯¥çœ‹åˆ°ï¼š**

```
NAME                    STATUS
netvalue_web           Up 2 minutes (healthy)
netvalue_api           Up 2 minutes
netvalue_timescaledb   Up 2 minutes (healthy)
```

âœ… **STATUS æ˜¾ç¤º `Up` å°±è¯´æ˜è¿è¡Œæ­£å¸¸ï¼**

### 2. æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose logs

# æŸ¥çœ‹ Web æœåŠ¡æ—¥å¿—
docker-compose logs web

# å®æ—¶æŸ¥çœ‹æ—¥å¿—ï¼ˆæŒ‰ Ctrl+C é€€å‡ºï¼‰
docker-compose logs -f
```

### 3. æµ‹è¯•è®¿é—®

åœ¨**æœ¬åœ°æµè§ˆå™¨**è¾“å…¥ï¼š

```
http://ä½ çš„æœåŠ¡å™¨IP:5000
```

**ä¾‹å¦‚ï¼š** `http://192.168.1.100:5000`

èƒ½çœ‹åˆ°ç•Œé¢å°±æˆåŠŸäº†ï¼ğŸ‰

---

## ç¬¬ä¸ƒæ­¥ï¼šé…ç½®é˜²ç«å¢™ï¼ˆé‡è¦ï¼ï¼‰

å¦‚æœå¤–ç½‘è®¿é—®ä¸äº†ï¼Œéœ€è¦å¼€æ”¾ç«¯å£ï¼š

```bash
# å¼€æ”¾ Web ç«¯å£ï¼ˆ5000ï¼‰
sudo ufw allow 5000

# å¼€æ”¾ API ç«¯å£ï¼ˆ8080ï¼‰
sudo ufw allow 8080

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable

# æŸ¥çœ‹çŠ¶æ€
sudo ufw status
```

**å¦‚æœæ˜¯äº‘æœåŠ¡å™¨ï¼ˆé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰ï¼‰**

è¿˜éœ€è¦åœ¨**äº‘æœåŠ¡å™¨æ§åˆ¶å°**çš„**å®‰å…¨ç»„**é‡Œæ·»åŠ è§„åˆ™ï¼š
- æ”¾è¡Œç«¯å£ `5000`ï¼ˆWebï¼‰
- æ”¾è¡Œç«¯å£ `8080`ï¼ˆAPIï¼‰

---

## å¸¸ç”¨æ“ä½œå‘½ä»¤

**æ³¨æ„ï¼šæ‰€æœ‰å‘½ä»¤éƒ½åœ¨ `docker` ç›®å½•ä¸‹æ‰§è¡Œï¼**

```bash
# å…ˆè¿›å…¥ docker ç›®å½•
cd docker
```

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
docker-compose ps
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹ Web æœåŠ¡æ—¥å¿—
docker-compose logs -f web

# æŸ¥çœ‹ API æœåŠ¡æ—¥å¿—
docker-compose logs -f api

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker-compose logs -f timescaledb
```

ğŸ’¡ **æç¤º**ï¼šæŒ‰ `Ctrl + C` é€€å‡ºæ—¥å¿—æŸ¥çœ‹

### åœæ­¢æœåŠ¡

```bash
docker-compose stop
```

### å¯åŠ¨æœåŠ¡

```bash
docker-compose start
```

### é‡å¯æœåŠ¡

```bash
# é‡å¯æ‰€æœ‰
docker-compose restart

# åªé‡å¯ Web
docker-compose restart web

# åªé‡å¯ API
docker-compose restart api
```

### åœæ­¢å¹¶åˆ é™¤å®¹å™¨

```bash
docker-compose down
```

ğŸ’¡ **æ³¨æ„**ï¼šè¿™ä¸ä¼šåˆ é™¤æ•°æ®ï¼æ•°æ®åœ¨ Docker çš„æ•°æ®å·é‡Œã€‚

### æŸ¥çœ‹èµ„æºå ç”¨

```bash
docker stats
```

### è¿›å…¥å®¹å™¨å†…éƒ¨ï¼ˆè°ƒè¯•ç”¨ï¼‰

```bash
# è¿›å…¥ Web å®¹å™¨
docker exec -it netvalue_web bash

# è¿›å…¥æ•°æ®åº“
docker exec -it netvalue_timescaledb psql -U netvalue_user -d net_value_db

# é€€å‡ºå®¹å™¨
exit
```

---

## æ›´æ–°ä»£ç 

å¦‚æœä½ ä¿®æ”¹äº†ä»£ç ï¼Œæƒ³é‡æ–°éƒ¨ç½²ï¼š

### æ–¹æ³•1ï¼šGit æ‹‰å–æ›´æ–°

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
git pull

# è¿›å…¥ docker ç›®å½•
cd docker

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker-compose build
docker-compose up -d
```

### æ–¹æ³•2ï¼šé‡æ–°ä¸Šä¼ ä»£ç 

```bash
# åœ¨æœ¬åœ°ç”µè„‘ä¸Šä¼ æ–°ä»£ç 
scp -r D:\Desktop\caculate_net_value ç”¨æˆ·å@æœåŠ¡å™¨IP:/root/

# åœ¨æœåŠ¡å™¨ä¸Š
cd /root/caculate_net_value/docker
docker-compose build
docker-compose up -d
```

---

## å¤‡ä»½æ•°æ®

### å¤‡ä»½æ•°æ®åº“

```bash
# å¤‡ä»½
docker exec netvalue_timescaledb pg_dump -U netvalue_user net_value_db > backup_$(date +%Y%m%d).sql

# æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶
ls -lh backup_*.sql
```

### æ¢å¤æ•°æ®åº“

```bash
# æ¢å¤
docker exec -i netvalue_timescaledb psql -U netvalue_user net_value_db < backup_20240101.sql
```

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šå®¹å™¨å¯åŠ¨å¤±è´¥

**è§£å†³æ–¹æ³•ï¼š**

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
cd docker
docker-compose logs web

# å¸¸è§åŸå› ï¼š
# - ç«¯å£è¢«å ç”¨ â†’ ä¿®æ”¹ .env æ–‡ä»¶ä¸­çš„ç«¯å£
# - é…ç½®é”™è¯¯ â†’ æ£€æŸ¥ .env æ–‡ä»¶
# - æ•°æ®åº“æœªå¯åŠ¨ â†’ å…ˆå¯åŠ¨æ•°æ®åº“ï¼šdocker-compose up -d timescaledb
```

### é—®é¢˜2ï¼šè®¿é—®ä¸äº†

**æ£€æŸ¥æ¸…å•ï¼š**

1. âœ… å®¹å™¨æ˜¯å¦è¿è¡Œï¼Ÿ â†’ `docker-compose ps`
2. âœ… é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ï¼Ÿ â†’ `sudo ufw status`
3. âœ… äº‘æœåŠ¡å™¨å®‰å…¨ç»„æ˜¯å¦é…ç½®ï¼Ÿ
4. âœ… ç«¯å£æ˜¯å¦æ­£ç¡®ï¼Ÿé»˜è®¤ 5000

### é—®é¢˜3ï¼šç«¯å£è¢«å ç”¨

**ä¿®æ”¹ç«¯å£ï¼š**

```bash
# ç¼–è¾‘ .env
nano .env

# ä¿®æ”¹ä¸ºå…¶ä»–ç«¯å£
WEB_PORT=5001
API_PORT=8081

# é‡å¯æœåŠ¡
cd docker
docker-compose down
docker-compose up -d
```

### é—®é¢˜4ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥æ•°æ®åº“æ˜¯å¦è¿è¡Œ
docker-compose ps timescaledb

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker-compose logs timescaledb

# é‡å¯æ•°æ®åº“
docker-compose restart timescaledb
```

---

## å®Œæ•´æµç¨‹æ€»ç»“ï¼ˆå¤ä¹ ç”¨ï¼‰

```bash
# 1. è¿æ¥æœåŠ¡å™¨
ssh root@ä½ çš„æœåŠ¡å™¨IP

# 2. å®‰è£… Dockerï¼ˆé¦–æ¬¡ï¼‰
# ... è§å‰é¢çš„å®‰è£…æ­¥éª¤ ...

# 3. ä¸Šä¼ é¡¹ç›®
git clone https://github.com/xxx/caculate_net_value.git
cd caculate_net_value

# 4. é…ç½®ç¯å¢ƒ
cp docker/env.example .env
nano .env  # ä¿®æ”¹å¯†ç 

# 5. å¯åŠ¨æœåŠ¡
chmod +x docker-start.sh
./docker-start.sh

# 6. éªŒè¯
cd docker
docker-compose ps

# 7. è®¿é—®
# æµè§ˆå™¨æ‰“å¼€: http://æœåŠ¡å™¨IP:5000
```

---

## è§†é¢‘æ•™ç¨‹å»ºè®®

å¦‚æœè¿˜æ˜¯ä¸å¤ªæ˜ç™½ï¼Œå¯ä»¥æœç´¢ï¼š
- "Ubuntu å®‰è£… Docker æ•™ç¨‹"
- "Docker Compose å…¥é—¨æ•™ç¨‹"
- "SSH è¿æ¥æœåŠ¡å™¨æ•™ç¨‹"

---

## å°è´´å£« ğŸ’¡

1. **ç¬¬ä¸€æ¬¡éƒ¨ç½²æ…¢æ˜¯æ­£å¸¸çš„**ï¼šDocker éœ€è¦ä¸‹è½½é•œåƒï¼Œå¯èƒ½éœ€è¦ 5-10 åˆ†é’Ÿ
2. **è®°ä½ä½ çš„æ•°æ®åº“å¯†ç **ï¼šå†™åœ¨è®°äº‹æœ¬é‡Œä¿å­˜å¥½
3. **å®šæœŸå¤‡ä»½æ•°æ®**ï¼šæ¯å‘¨æ‰§è¡Œä¸€æ¬¡å¤‡ä»½å‘½ä»¤
4. **æŸ¥çœ‹æ—¥å¿—å¾ˆé‡è¦**ï¼šé‡åˆ°é—®é¢˜å…ˆçœ‹æ—¥å¿—
5. **ä¸è¦ç”¨ `Ctrl + Z`**ï¼šè¿™ä¼šæŒ‚èµ·è¿›ç¨‹ï¼Œç”¨ `Ctrl + C` é€€å‡º

---

## éœ€è¦å¸®åŠ©ï¼Ÿ

é‡åˆ°é—®é¢˜å¯ä»¥ï¼š
1. æŸ¥çœ‹æ—¥å¿—ï¼š`docker-compose logs -f`
2. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„"æ•…éšœæ’æŸ¥"éƒ¨åˆ†
3. æ£€æŸ¥ `.env` é…ç½®æ˜¯å¦æ­£ç¡®
4. é‡å¯æœåŠ¡è¯•è¯•ï¼š`docker-compose restart`

---

**ç¥ä½ éƒ¨ç½²æˆåŠŸï¼** ğŸ‰

å¦‚æœ‰ç–‘é—®ï¼Œéšæ—¶æé—®ã€‚

